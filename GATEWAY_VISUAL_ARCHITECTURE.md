# ?? WMS Gateway - Visual Architecture

## Gateway Request Flow

```
???????????????????????????????????????????????????????????????????
?                        CLIENT REQUEST                           ?
?                  (Browser, Postman, Mobile App)                 ?
???????????????????????????????????????????????????????????????????
                             ?
                             ?
                 ?????????????????????????
                 ?   WMS.Gateway         ?
                 ?   Port: 7000 (HTTPS)  ?
                 ?   YARP Reverse Proxy  ?
                 ?????????????????????????
                             ?
         ?????????????????????????????????????????
         ?                   ?                   ?
         ?                   ?                   ?
   /auth/*             /products/*          /locations/*
         ?                   ?                   ?
         ?                   ?                   ?
???????????????     ???????????????     ???????????????
?  Auth API   ?     ? Products API?     ?Locations API?
?  Port: 7081 ?     ? Port: 62527 ?     ? Port: 62522 ?
???????????????     ???????????????     ???????????????

         ?                   ?                   ?
         ?                   ?                   ?
   /inventory/*        /inbound/*          /outbound/*
         ?                   ?                   ?
         ?                   ?                   ?
???????????????     ???????????????     ???????????????
?Inventory API?     ? Inbound API ?     ? Outbound API?
? Port: 62531 ?     ? Port: 62520 ?     ? Port: 62519 ?
???????????????     ???????????????     ???????????????

         ?                   ?
         ?                   ?
   /payment/*          /delivery/*
         ?                   ?
         ?                   ?
???????????????     ???????????????
? Payment API ?     ? Delivery API?
? Port: 62521 ?     ? Port: 62529 ?
???????????????     ???????????????
         ?                   ?
         ?????????????????????
                     ?
                     ?
         ?????????????????????????
         ?   WMS.Domain          ?
         ?   - DbContext         ?
         ?   - Repositories      ?
         ?   - SQL Server        ?
         ?????????????????????????
```

---

## Route Transformation Flow

### Example 1: Login Request

```
????????????????????????????????????????????????????????????????
? Step 1: Client Request                                       ?
? POST https://localhost:7000/auth/login                       ?
? Body: {"username":"admin","password":"Admin@123"}           ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 2: Gateway Route Matching                               ?
? Route: "auth-login-route"                                    ?
? ClusterId: "auth-cluster"                                    ?
? Match: Path="/auth/login", Method="POST"                     ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 3: Path Transformation                                  ?
? Transform: "/auth/login" ? "/api/auth/login"                ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 4: Forward to Service                                   ?
? Target: https://localhost:7081/api/auth/login                ?
? Cluster: auth-cluster                                        ?
? Destination: auth-api                                        ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 5: Service Response                                     ?
? {                                                             ?
?   "isSuccess": true,                                         ?
?   "data": {                                                  ?
?     "accessToken": "eyJhbGc...",                            ?
?     "refreshToken": "refresh_token"                         ?
?   }                                                          ?
? }                                                            ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 6: Gateway Returns Response to Client                   ?
? Status: 200 OK                                               ?
? Body: Service response (unchanged)                           ?
????????????????????????????????????????????????????????????????
```

### Example 2: Get Products with Authentication

```
????????????????????????????????????????????????????????????????
? Step 1: Client Request                                       ?
? GET https://localhost:7000/products?pageNumber=1             ?
? Header: Authorization: Bearer eyJhbGc...                     ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 2: Gateway Route Matching                               ?
? Route: "products-get-all-route"                              ?
? ClusterId: "products-cluster"                                ?
? Match: Path="/products"                                      ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 3: Path & Query String Transformation                   ?
? Transform: "/products?pageNumber=1"                          ?
?         ? "/api/products?pageNumber=1"                       ?
? Header forwarded: Authorization: Bearer eyJhbGc...          ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 4: Forward to Service                                   ?
? Target: https://localhost:62527/api/products?pageNumber=1    ?
? Cluster: products-cluster                                    ?
? Destination: products-api                                    ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 5: Service Validates JWT & Returns Data                 ?
? {                                                             ?
?   "isSuccess": true,                                         ?
?   "data": {                                                  ?
?     "items": [...],                                          ?
?     "totalCount": 100,                                       ?
?     "pageNumber": 1                                          ?
?   }                                                          ?
? }                                                            ?
????????????????????????????????????????????????????????????????
                     ?
                     ?
????????????????????????????????????????????????????????????????
? Step 6: Gateway Returns Response to Client                   ?
? Status: 200 OK                                               ?
????????????????????????????????????????????????????????????????
```

---

## Service Dependencies Map

```
???????????????????????????????????????????????????????????????
?                        WMS.Gateway                          ?
?                       (Entry Point)                         ?
???????????????????????????????????????????????????????????????
                         ?
        ???????????????????????????????????
        ?                ?                ?
        ?                ?                ?
   ??????????      ????????????    ????????????
   ?  Auth  ?      ? Products ?    ?Locations ?
   ?  API   ?      ?   API    ?    ?   API    ?
   ??????????      ????????????    ????????????
        ?               ?               ?
        ?               ?????????????????
        ?                       ?
        ?                       ?
   ???????????           ????????????
   ? Users   ?           ?Inventory ?
   ? (Auth)  ?           ?   API    ?
   ???????????           ????????????
                              ?
        ?????????????????????????????????????????????
        ?                     ?                     ?
        ?                     ?                     ?
   ???????????          ???????????          ???????????
   ? Inbound ?          ?Outbound ?          ? Payment ?
   ?   API   ?          ?   API   ?          ?   API   ?
   ???????????          ???????????          ???????????
        ?                    ?                    ?
        ?                    ??????????????????????
        ?                             ?
        ?                             ?
        ?                      ????????????
        ?                      ? Delivery ?
        ?                      ?   API    ?
        ?                      ????????????
        ?                           ?
        ?????????????????????????????
                        ?
                        ?
              ?????????????????????
              ?   WMS.Domain      ?
              ?   - Entities      ?
              ?   - DbContext     ?
              ?   - SQL Server    ?
              ?????????????????????
```

---

## Endpoint Count by Service

```
??????????????????????????????????????????????????????
? Service            ? Endpoint Count                ?
??????????????????????????????????????????????????????
? Auth               ? ????? 5                       ?
? Products           ? ??????? 7                     ?
? Locations          ? ??????? 7                     ?
? Inventory          ? ??????? 7                     ?
? Inbound            ? ????? 5                       ?
? Outbound           ? ?????? 6                      ?
? Payment            ? ????? 5                       ?
? Delivery           ? ???????? 8                    ?
??????????????????????????????????????????????????????
? TOTAL              ? ???????????????????? 50+      ?
??????????????????????????????????????????????????????
```

---

## Request/Response Path

### Successful Request
```
Client ? Gateway ? Service ? Domain ? Database
   ?        ?         ?         ?         ?
Request  Route    Handler   Repository  SQL
         Match    Process   Query       Execute
   ?        ?         ?         ?         ?
Response ? Gateway ? Service ? Domain ? Result
```

### Failed Request (Authentication Error)
```
Client ? Gateway ? Service ? Auth Check ? STOP
   ?        ?         ?         ?
Request  Route    Handler   Unauthorized
         Match    Process   (401)
   ?        ?         ?
Response ? Gateway ? Error
```

---

## Gateway Configuration Structure

```
appsettings.json
??? Logging
?   ??? LogLevel
??? AllowedHosts
??? ReverseProxy
    ??? Routes (50+ routes)
    ?   ??? auth-login-route
    ?   ??? auth-register-route
    ?   ??? products-get-all-route
    ?   ??? products-create-route
    ?   ??? locations-get-all-route
    ?   ??? inventory-get-all-route
    ?   ??? inbound-create-route
    ?   ??? outbound-ship-route
    ?   ??? payment-confirm-route
    ?   ??? delivery-track-route
    ??? Clusters (8 clusters)
        ??? auth-cluster ? https://localhost:7081
        ??? products-cluster ? https://localhost:62527
        ??? locations-cluster ? https://localhost:62522
        ??? inventory-cluster ? https://localhost:62531
        ??? inbound-cluster ? https://localhost:62520
        ??? outbound-cluster ? https://localhost:62519
        ??? payment-cluster ? https://localhost:62521
        ??? delivery-cluster ? https://localhost:62529
```

---

## Port Allocation Map

```
7000  ????? Gateway (HTTPS Entry Point)
7081  ????? Auth API
62519 ????? Outbound API
62520 ????? Inbound API
62521 ????? Payment API
62522 ????? Locations API
62527 ????? Products API
62529 ????? Delivery API
62531 ????? Inventory API
```

---

## Authentication Flow Diagram

```
????????????
?  Client  ?
????????????
     ? 1. POST /auth/login
     ?    {username, password}
     ?
????????????????
?   Gateway    ?
?   Port 7000  ?
????????????????
     ? 2. Forward to Auth API
     ?    POST /api/auth/login
     ?
????????????????
?   Auth API   ?
?   Port 7081  ?
????????????????
     ? 3. Validate credentials
     ?    Generate JWT token
     ?
????????????????
?   Database   ?
????????????????
     ? 4. Return user data
     ?
????????????????
?   Auth API   ?
????????????????
     ? 5. Return JWT + user info
     ?
????????????????
?   Gateway    ?
????????????????
     ? 6. Forward response
     ?
????????????
?  Client  ? ??? Store token for future requests
????????????
```

---

**Visual Guide Version:** 1.0  
**Last Updated:** 2024-01-24  
**Status:** ? Complete
